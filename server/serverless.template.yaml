AWSTemplateFormatVersion: '2010-09-09'
Transform: 'AWS::Serverless-2016-10-31'
Description: 'An AWS Serverless Application.'

Parameters:
  DomainName:
    Type: String
    Default: api.cryptointheblack.com
  HostedZoneName:
    Type: String
    Default: cryptointheblack.com.

Resources:
  Get:
    Type: AWS::Serverless::Function
    Properties:
      Handler: CryptoInTheBlack::CryptoInTheBlack.Functions::Get
      Runtime: dotnetcore2.1
      CodeUri: ""
      MemorySize: 256
      Timeout: 30
      Role: null
      Policies: AWSLambdaBasicExecutionRole
      Events: 
        RootGet: 
          Type: Api 
          Properties: 
            Path: / 
            Method: GET

  APIDomainName:
    Type: AWS::ApiGateway::DomainName
    Properties: 
      CertificateArn: arn:aws:acm:us-east-1:447069887009:certificate/51c9fb90-f271-4366-8116-450e6c606fee
      DomainName: !Ref DomainName

  APIBasePathMapping:
    Type: AWS::ApiGateway::BasePathMapping
    Properties:
      DomainName: !Ref APIDomainName
      RestApiId: !Ref ServerlessRestApi
      Stage: Prod

  APIDomain:
    Type: AWS::Route53::RecordSetGroup
    Properties: 
      HostedZoneName: !Ref HostedZoneName
      RecordSets:
      - Name: !Ref DomainName
        Type: A
        AliasTarget:
          DNSName: !GetAtt APIDomainName.DistributionDomainName
          HostedZoneId: Z2FDTNDATAQYW2

Outputs:
  ApiURL:
    Description: 'API endpoint URL for Prod environment'
    Value:
      'Fn::Sub': 'https://${ServerlessRestApi}.execute-api.${AWS::Region}.amazonaws.com/Prod/'
